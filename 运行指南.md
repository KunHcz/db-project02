# 智能家居设备日志管理系统 - 运行指南

## 🚀 快速启动

系统已经部署并运行中！

### 访问地址
- **前端页面**: http://localhost:5001
- **API接口**: http://localhost:5001/api

### 当前状态
- ✅ MongoDB服务: 运行正常
- ✅ Flask后端服务: 运行正常  
- ✅ 数据已导入: 80个设备，12,000条日志

## 📖 使用步骤

### 1. 打开浏览器
在浏览器地址栏输入：`http://localhost:5001`

### 2. 功能页面

#### 设备管理页面（首页）
- 查看所有设备列表
- 添加新设备
- 编辑设备信息
- 删除设备
- 按类型/状态筛选设备
- 地理位置查询附近设备
- 查看设备统计信息

#### 日志查询页面
- 查看所有日志
- 按设备ID、类型、时间范围筛选
- 全文搜索日志内容
- 查看日志统计图表
- 添加新日志

## 🛠️ 管理命令

### 启动服务
```bash
cd /Users/hooke/Desktop/homework/db-project02
./start.sh
```
或者：
```bash
docker-compose up -d
```

### 停止服务
```bash
docker-compose down
```

### 重启服务
```bash
docker-compose restart
```

### 查看日志
```bash
# 查看所有服务日志
docker-compose logs -f

# 只查看后端日志
docker logs smart_home_backend -f

# 只查看MongoDB日志
docker logs smart_home_mongodb -f
```

### 重新导入数据
```bash
docker exec smart_home_backend python /app/scripts/import_data.py --clear
```

### 备份数据库
```bash
cd code/scripts
python backup_db.py backup
```

## 🔍 API测试示例

### 获取所有设备
```bash
curl http://localhost:5001/api/devices
```

### 获取设备统计
```bash
curl http://localhost:5001/api/devices/stats
```

### 查询附近设备
```bash
curl "http://localhost:5001/api/devices/nearby?longitude=113.2644&latitude=23.1291&max_distance=5000"
```

### 获取日志列表
```bash
curl "http://localhost:5001/api/logs?page=1&per_page=10"
```

### 获取日志统计
```bash
curl http://localhost:5001/api/logs/stats
```

## 📝 注意事项

1. **端口**: 系统使用端口5001（如果5001被占用，可修改docker-compose.yml）
2. **数据持久化**: MongoDB数据存储在Docker卷中，删除容器不会丢失数据
3. **首次使用**: 如果数据为空，运行数据导入脚本即可

## ❓ 常见问题

### Q: 无法访问页面？
A: 检查服务是否运行：`docker-compose ps`

### Q: 页面显示无数据？
A: 运行数据导入脚本导入示例数据

### Q: 如何修改端口？
A: 编辑`docker-compose.yml`文件，修改`ports`配置

---

**现在就可以在浏览器中打开 http://localhost:5001 开始使用了！** 🎉


